# Physics & Controls Overhaul Walkthrough

物理ベースのサーブ軌道計算と、直感的な制御システムを実装しました。

## 実装された機能

### Phase 1: 物理ベースの軌道計算
従来の人工的なカーブ（Sin/Cosスプライン）を廃止し、**重力と初速に基づいた物理計算**（斜方投射）を導入しました。これにより、「2mから急に落ちる」ような不自然な挙動が解消されました。

### Phase 2: サーバー設定の改良
- **打点高さの調整**: 50cm～250cm（デフォルト100cm）の範囲で設定可能になりました。アンダーサーブからオーバーヘッドまで対応できます。
- **UI整理**: 設定を「Server Settings」「Target Settings」「Physics Parameters」の3グループに分類し、見やすくしました。

### Phase 3: 直感的な軌道パラメータ
「打ち出し角度」という物理的だが直感的でないパラメータを、以下の2つに置き換えました：

1. **軌道の最高点の高さ** (0.5m - 10m)
   - ボールが到達する最大の高さを直接指定
   
2. **最高点の位置** (-6m ～ +12m、ネット基準)
   - ネット（Z=0）を基準に、どこで最高点に達するかを指定
   - 負の値: サーバー側で最高点
   - 正の値: 相手コート側で最高点

物理エンジンは、これらのパラメータから最適な打ち出し角度を自動計算します。

### 双方向のサーブ制御（Phase 1から継続）
コントロールパネルで以下の2つのアプローチが可能です：

- **着弾点指定（Outcome Based）**:
  - `Target X/Z` スライダーや 3Dマーカーのドラッグで着弾点を決めると、**「ネットを越える最速のサーブ」**になるように速度と軌道パラメータが自動計算されます。

- **物理パラメータ指定（Physics Based）**:
  - `Serve Speed` や軌道パラメータを直接変更すると、物理法則に従って着弾点（Target X/Z）が更新されます。

### インタラクティブな3D操作（Phase 1から継続）
- **OrbitControls**: マウスドラッグでカメラを回転、ホイールでズーム
- **着弾点マーカー**: コート上の緑色のマーカーをドラッグして直感的に着弾位置を変更

## 検証手順

1. **サーバー高さの変更**:
   - `打点高さ` を50cm（アンダーサーブ）から250cm（高身長選手のオーバーヘッド）まで変更し、軌道が変化することを確認してください。

2. **軌道パラメータの調整**:
   - `軌道の最高点の高さ` を上げると、山なりの軌道になります。
   - `最高点の位置` を負の値にすると、サーバー側で頂点を迎える「ロブ」のような軌道になります。
   - 正の値にすると、相手コート側で頂点を迎える「ドライブ」のような軌道になります。

3. **着弾点の変更**:
   - `Target Z` (深さ) を変更し、深くすると速度が上がり、浅くすると山なりになることを確認してください。

この変更により、シミュレーターはより直感的で、物理的に正しい挙動を示すようになりました。
