# 物理的矛盾と軌道修正の実装計画

## 概要
ユーザーから報告された「軌道が不自然に急降下する」および「バウンド位置の矛盾」に関する調査結果と、それを解消するための修正案です。

## 分析結果

### 1. 「一気に落ちる」原因
**ユーザーの設定値**: 高さ4m, 最高点+2m (ネットを超えて相手コート側2m)
**物理的な実態**:
- サーブの開始位置: ネットから約-12m
- バウンド位置: ネットから約+4.5m
- **自然な最高点**: 通常、ボールの最高点はこれらの中間点（ネットから**手前-3m〜-4m付近**）に来るはずです。
- **今回の設定**: 最高点を「ネットの**奥+2m**」に強制しています。
- **結果**: ボールはネットを越えるまで上昇/水平飛行を続け、残りのわずか2.5mの距離で4mもの高さを落下しなければならず、物理的に不可能な急降下が発生しています。

### 2. 「バウンド位置が固定されている？」
はい、現在は以下の設定で固定されています。
- **左右 (X座標)**: 「センター」「ワイド」「ボディ」の3択で固定。
- **深さ (Z座標)**: 「バウンド深さ」スライダーで調整可能。

この「左右の固定」と「深さの調整」に加えて「最高点」を個別に設定できるため、放物線として成立しない形状（矛盾）が生じやすくなっています。

## 提案する変更
物理的な矛盾を完全に防ぐ（自動補正する）ことも可能ですが、現在のシミュレーターの目的（設定値を検証する）を考慮し、**「ユーザーが自由な位置にバウンドを設定できる」** ように機能を拡張します。これにより、ユーザーは軌道に合わせてバウンド位置を調整し、矛盾を目視で確認・修正できるようになります。

### 1. `PhysicsEngine.ts` / `types.ts`
- `bounceDirection` による固定座標計算に加え、任意の `targetX` (左右位置) を受け入れられるように変更します。
- 物理計算ロジックを更新し、指定された `targetX` を使用するようにします。

### 2. `ControlPanel.tsx`
- 「コース」選択（センター/ワイド/ボディ）は**プリセット**として残します。
- 新たに **「バウンド左右位置」スライダー** を追加します（範囲: -5.5m 〜 +5.5m）。
- プリセットを選ぶとスライダーが移動し、スライダーを動かすとプリセットが「カスタム」になります。

### 3. (オプション) 警告表示
- 最高点が物理的に不自然な位置（ネットより奥など）にある場合、UI上にヒントを表示することを検討しましたが、まずはパラメータの自由度向上を優先します。

## 検証計画

### 自動テスト
- 変更箇所のユニットテスト（もしあれば）。現状は視覚的な確認が主となります。

### 手動検証手順
1. アプリケーションを起動する。
2. 「コース」を変更し、ボールが適切な位置（センター/ワイド/ボディ）に飛ぶことを確認する。
3. 新設された「バウンド左右位置」スライダーを操作し、バウンド位置が左右に滑らかに移動することを確認する。
4. ユーザー報告の設定（高さ4m, 最高点2m）を再現し、スライダーでバウンド位置を遠くにずらすことで、軌道の急降下が緩和される（あるいは意図通りの場所に落とせる）ことを確認する。
